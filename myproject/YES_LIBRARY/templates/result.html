<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YES LIBRARY</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='result.css') }}">
    <!-- <link rel="stylesheet" type="text/css" href="result.css"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <style type="text/css">
        .tg {
            border-collapse: collapse;
            border-spacing: 0;
        }

        .tg td {
            border-color: black;
            border-style: solid;
            border-width: 1px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            overflow: hidden;
            padding: 10px 5px;
            word-break: normal;
        }

        .tg th {
            border-color: black;
            border-style: solid;
            border-width: 1px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            font-weight: normal;
            overflow: hidden;
            padding: 10px 5px;
            word-break: normal;
        }

        .tg .tg-8jgo {
            border-color: #ffffff;
            text-align: center;
            vertical-align: top
        }

        .tg .tg-id4c {
            background-color: #fbe1df;
            border-color: #fbe1df;
            font-weight: bold;
            text-align: center;
            vertical-align: top
        }

        .tg .tg-ufv0 {
            background-color: #fbe1df;
            border-color: #fbe1df;
            font-weight: bold;
            text-align: center;
            vertical-align: middle
        }

        .tg .tg-v0mg {
            border-color: #ffffff;
            text-align: center;
            vertical-align: middle
        }
    </style>
</head>

<body>
    <div class="divWrap">
        <div class="divHeader">
            <div class="title">
                <a href="/"><img src="{{ url_for('static', filename='result_logo.PNG') }}" alt=""></a>
            </div>
            <div class="search">
                <input type="text" class="searchTerm" id="searchBox" placeholder="제목과 저자로 검색해주세요. ex) 쇼코의 미소 최은영">
                <button type="submit" class="searchButton" onclick="searching()">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>
        <div class="divContainer">
            <div class="contents">
                <div class="catalog">
                    <div class="title">
                        <h3>연세대</h3>
                    </div>
                    <div id="yonsei-blocks">
                    </div>

                </div>
                <div class="catalog">
                    <div class="title">
                        <h3>이화여대</h3>
                    </div>
                    <div id="ewha-blocks">
                    </div>
                </div>
                <div class="catalog">
                    <div class="title">
                        <h3>서강대</h3>
                    </div>
                    <div id="sogang-blocks">
                    </div>
                </div>
                <div class="share">
                    카카오톡 공유하기
                </div>
            </div>
        </div>

        <script>

            $(document).ready(function () {
                get_result("{{keyword}}");
            });

            function get_result(keyword) {
                alert(keyword)
                $.ajax({
                    type: "GET",
                    url: `/result/getlist?keyword_give=${keyword}`,
                    success: function (response) {
                        if (response['result'] == 'success') {
                            console.log(response['row']['libraryStatus'])
                            alert(response['msg']);
                            let univs = ['yonsei', 'ewha', 'sogang'];
                            let yonsei_list = response['row']['libraryStatus']['yonsei']
                            let ewha_list = response['row']['libraryStatus']['ewha']
                            let sogang_list = response['row']['libraryStatus']['sogang']
                            make_card('yonsei', yonsei_list)
                            make_card('ewha', ewha_list)
                            make_card('sogang', sogang_list)
                                // let univs = ['yonsei', 'ewha', 'sogang'];
                                // for (let a = 0; a < univs.lenght; a++) {
                                //     uni = univs[a]

                                // }
                                // let yonsei = response['row']['libraryStatus']['yonsei']
                                // for (let i = 0; i < yonsei.length; i++) {
                                //     let title = yonsei[i]['title']
                                //     let author = yonsei[i]['author']
                                //     let bookcover = yonsei[i]['bookcover']
                                //     let book_url = yonsei[i]['book_url']
                                //     let year = yonsei[i]['year']
                                //     let company = yonsei[i]['company']
                                //     let loc = yonsei[i]['loc']
                                //     let status = yonsei[i]['status']

                                //     if (loc.length == 1) {
                                //         let temp_html = `<div class="media">
                                //                         <img src="${bookcover}" onerror="this.src='https://library.yonsei.ac.kr/image/ko/solution/common/ico/type_m_M.png'" class="align-self-center mr-3"
                                //                         style="width: 85px; height: 125px; border: 1px solid #d0d0d0;">
                                //                         <div class="media-body">
                                //                             <a href="${book_url}">
                                //                                 <h5 class="mt-0">${title}</h5>
                                //                             </a>
                                //                             <p>
                                //                                 ${author} | ${company} | ${year}
                                //                             </p>
                                //                             <p class="mb-0">
                                //                                 ${loc[0]}
                                //                             </p>
                                //                             <p class="mb-0">
                                //                                 <div onclick="openclose('yonsei-status${i}')">
                                //                                     <i class="fa fa-plus" aria-hidden="true"></i>
                                //                                 </div>
                                //                             </p>
                                //                             <div class="status" style='display : none' id="yonsei-status${i}">
                                //                                 <table class="tg">
                                //                                     <thead>
                                //                                         <tr>
                                //                                             <th class="tg-id4c">No.</th>
                                //                                             <th class="tg-ufv0">소장처 / 자료실</th>
                                //                                             <th class="tg-id4c">청구기호</th>
                                //                                             <th class="tg-id4c">도서상태</th>
                                //                                         </tr>
                                //                                     </thead>
                                //                                     <tbody id='yonsei-table${i}'>
                                //                                     </tbody>
                                //                                 </table>
                                //                             </div>
                                //                         </div>
                                //                     </div>`
                                //         $("#yonsei-blocks").append(temp_html);
                                //     } else {
                                //         let temp_html = `<div class="media">
                                //                         <img src="${bookcover}" onerror="this.src='https://library.yonsei.ac.kr/image/ko/solution/common/ico/type_m_M.png'" class="align-self-center mr-3"
                                //                         style="width: 85px; height: 125px; border: 1px solid #d0d0d0">
                                //                         <div class="media-body">
                                //                             <a href="${book_url}">
                                //                                 <h5 class="mt-0">${title}</h5>
                                //                             </a>
                                //                             <p>
                                //                                 ${author} | ${company} | ${year}
                                //                             </p>
                                //                             <p class="mb-0">
                                //                                 ${loc[0]}
                                //                             </p>
                                //                             <p class="mb-0">
                                //                                 ${loc[1]}
                                //                             </p>
                                //                             <p class="mb-0">
                                //                                 <div onclick="openclose('yonsei-status${i}')">
                                //                                     <i class="fa fa-plus" aria-hidden="true"></i>
                                //                                 </div>
                                //                             </p>
                                //                             <div class="status" style='display : none' id="yonsei-status${i}">
                                //                                 <table class="tg">
                                //                                     <thead>
                                //                                         <tr>
                                //                                             <th class="tg-id4c">No.</th>
                                //                                             <th class="tg-ufv0">소장처 / 자료실</th>
                                //                                             <th class="tg-id4c">청구기호</th>
                                //                                             <th class="tg-id4c">도서상태</th>
                                //                                         </tr>
                                //                                     </thead>
                                //                                     <tbody id='yonsei-table${i}'>
                                //                                     </tbody>
                                //                                 </table>
                                //                             </div>
                                //                         </div>
                                //                     </div>`
                                //         $("#yonsei-blocks").append(temp_html);
                                //     }

                                //     for (let j = 0; j < status.length; j++) {
                                //         let book_loc = status[j]['book_loc'];
                                //         let callnum = status[j]['callnum'];
                                //         let borrow = status[j]['borrow'];
                                //         let num = j + 1;

                                //         let temp_html2 = `<tr>
                                //                     <td class="tg-8jgo">${num}</td>
                                //                     <td class="tg-v0mg">${book_loc}</td>
                                //                     <td class="tg-8jgo">${callnum}</td>
                                //                     <td class="tg-8jgo">${borrow}</td>
                                //                 </tr>`

                                //         $('#yonsei-table' + i).append(temp_html2);

                                //     }
                                // }
                            }
                        }
                    });
            }

            function openclose(id) {
                // id 값 post-box의 display 값이 block 이면
                if ($('#' + id).css('display') == 'block') {
                    // post-box를 가리고
                    $('#' + id).hide();
                } else {
                    // 아니면 post-box를 펴라
                    $('#' + id).show();

                }
            }
            function make_card(uni_name, uni_list=[]) {
                for (let i = 0; i < uni_list.length; i++) {
                    let title = uni_list[i]['title']
                    let author = uni_list[i]['author']
                    let bookcover = uni_list[i]['bookcover']
                    let book_url = uni_list[i]['book_url']
                    let year = uni_list[i]['year']
                    let company = uni_list[i]['company']
                    let loc = uni_list[i]['loc']
                    let status = uni_list[i]['status']

                    if (loc.length == 1) {
                        let temp_html = `<div class="media">
                                                    <img src="${bookcover}" onerror="this.src='https://library.yonsei.ac.kr/image/ko/solution/common/ico/type_m_M.png'" class="align-self-center mr-3"
                                                    style="width: 85px; height: 125px; border: 1px solid #d0d0d0;">
                                                    <div class="media-body">
                                                        <a href="${book_url}">
                                                            <h5 class="mt-0">${title}</h5>
                                                        </a>
                                                        <p>
                                                            ${author} | ${company} | ${year}
                                                        </p>
                                                        <p class="mb-0">
                                                            ${loc[0]}
                                                        </p>
                                                        <p class="mb-0">
                                                            <div onclick="openclose('${uni_name}-status${i}')">
                                                                <i class="fa fa-plus" aria-hidden="true"></i>
                                                            </div>
                                                        </p>
                                                        <div class="status" style='display : none' id="${uni_name}-status${i}">
                                                            <table class="tg">
                                                                <thead>
                                                                    <tr>
                                                                        <th class="tg-id4c">No.</th>
                                                                        <th class="tg-ufv0">소장처 / 자료실</th>
                                                                        <th class="tg-id4c">청구기호</th>
                                                                        <th class="tg-id4c">도서상태</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id='${uni_name}-table${i}'>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>`
                        $("#" + uni_name + "-blocks").append(temp_html);
                    } else {
                        let temp_html = `<div class="media">
                                                    <img src="${bookcover}" onerror="this.src='https://library.yonsei.ac.kr/image/ko/solution/common/ico/type_m_M.png'" class="align-self-center mr-3"
                                                    style="width: 85px; height: 125px; border: 1px solid #d0d0d0">
                                                    <div class="media-body">
                                                        <a href="${book_url}">
                                                            <h5 class="mt-0">${title}</h5>
                                                        </a>
                                                        <p>
                                                            ${author} | ${company} | ${year}
                                                        </p>
                                                        <p class="mb-0">
                                                            ${loc[0]}
                                                        </p>
                                                        <p class="mb-0">
                                                            ${loc[1]}
                                                        </p>
                                                        <p class="mb-0">
                                                            <div onclick="openclose('${uni_name}-status${i}')">
                                                                <i class="fa fa-plus" aria-hidden="true"></i>
                                                            </div>
                                                        </p>
                                                        <div class="status" style='display : none' id="${uni_name}-status${i}">
                                                            <table class="tg">
                                                                <thead>
                                                                    <tr>
                                                                        <th class="tg-id4c">No.</th>
                                                                        <th class="tg-ufv0">소장처 / 자료실</th>
                                                                        <th class="tg-id4c">청구기호</th>
                                                                        <th class="tg-id4c">도서상태</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id='${uni_name}-table${i}'>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>`
                        $("#" + uni_name + "-blocks").append(temp_html);
                    }

                    for (let j = 0; j < status.length; j++) {
                        let book_loc = status[j]['book_loc'];
                        let callnum = status[j]['callnum'];
                        let borrow = status[j]['borrow'];
                        let num = j + 1;

                        let temp_html2 = `<tr>
                                                <td class="tg-8jgo">${num}</td>
                                                <td class="tg-v0mg">${book_loc}</td>
                                                <td class="tg-8jgo">${callnum}</td>
                                                <td class="tg-8jgo">${borrow}</td>
                                            </tr>`

                        $('#' + uni_name + '-table' + i).append(temp_html2);

                    }
                }
            }

            function searching() {
                let keyword = $("#searchBox").val();
                window.location.href = `/result?keyword_give=${keyword}`;
            }
        </script>
</body>

</html>